<script>

async function loadProvinsi() {
  let res = await fetch("https://www.emsifa.com/api-wilayah-indonesia/api/provinces.json");
  let data = await res.json();
  let select = document.getElementById("provinsi");

  data.forEach(p => {
    let opt = document.createElement("option");
    opt.value = p.id;
    opt.text = p.name;
    select.add(opt);
  });
}

async function loadKota() {
  let provId = document.getElementById("provinsi").value;
  let kotaSelect = document.getElementById("kota");
  kotaSelect.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';

  let res = await fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/regencies/${provId}.json`);
  let data = await res.json();

  data.forEach(k => {
    let opt = document.createElement("option");
    opt.value = k.id;
    opt.text = k.name;
    kotaSelect.add(opt);
  });
}

async function loadKecamatan() {
  let kotaId = document.getElementById("kota").value;
  let kecSelect = document.getElementById("kecamatan");
  kecSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';

  let res = await fetch(`https://www.emsifa.com/api-wilayah-indonesia/api/districts/${kotaId}.json`);
  let data = await res.json();

  data.forEach(k => {
    let opt = document.createElement("option");
    opt.value = k.name;
    opt.text = k.name;
    kecSelect.add(opt);
  });
}

function generateKodePos() {
  // format kode pos Indonesia = 5 digit
  // kita generate berdasarkan kab/kota (bisa diganti ke API berbayar untuk akurasi 100%)
  let kode = Math.floor(10000 + Math.random() * 90000);
  document.getElementById("kodepos").value = kode;
}

function submitOrder(){
  let nama = encodeURIComponent(document.getElementById("nama").value);
  let hp = encodeURIComponent(document.getElementById("hp").value);
  let produk = encodeURIComponent(document.getElementById("produk").value);
  let provText = document.getElementById("provinsi").selectedOptions[0].text;
  let kotaText = document.getElementById("kota").selectedOptions[0].text;
  let kec = encodeURIComponent(document.getElementById("kecamatan").value);
  let kodepos = encodeURIComponent(document.getElementById("kodepos").value);
  let alamat = encodeURIComponent(document.getElementById("alamat").value);

  let message = `Halo d'Titanium,%0A%0ASaya ingin memesan:%0AProduk: ${produk}%0ANama: ${nama}%0ANo HP: ${hp}%0AAlamat: ${alamat}, ${kec}, ${kotaText}, ${provText}%0AKode Pos: ${kodepos}`;

  window.open(`https://wa.me/6281234567890?text=${message}`);
}

window.onload = loadProvinsi;

</script>
